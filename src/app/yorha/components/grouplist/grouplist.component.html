<div class="group">
    <h2>Groups</h2>

    <div class="group__buttons">
        <div class="group__buttons__create">
            <app-cyber-button
                [buttonText]="'Create'"
                (click)="onCreateClick()"
                [disabled]="
                    showDeleteModal || (this.isGroupLoading$ | async) || false
                "
            ></app-cyber-button>
        </div>
        <div class="group__buttons__refresh">
            <div *ngIf="countdownSubscription | async">
                Next update in {{ countdownSubscription | async }} seconds
            </div>

            <button
                class="group__buttons__refresh__button"
                [disabled]="
                    (countdownSubscription | async) ||
                    (this.isGroupLoading$ | async)
                "
                (click)="onRefreshClick()"
            >
                <mat-icon>refresh</mat-icon>
            </button>
        </div>
    </div>

    <div
        class="group__list"
        *ngIf="groupItems$ | async as groupData; else loading"
    >
        <ul class="group__list__items">
            <li *ngFor="let item of groupData" class="group__list__item">
                <a href="#" class="group__list__item__link">{{
                    item.name.S
                }}</a>
                <button
                    type="button"
                    class="group__list__item__delete"
                    [disabled]="
                        isCreateMode || (this.isGroupLoading$ | async) || false
                    "
                    (click)="openDeleteModal(item.id.S)"
                    *ngIf="item.createdBy.S === currentLocalStorageUID.uid"
                >
                    <mat-icon>delete</mat-icon>
                </button>
            </li>
        </ul>
    </div>

    <div *ngIf="showDeleteModal">
        <div class="group__modal">
            <h2 class="group__modal__title">
                Are you sure you want to delete this group?
            </h2>
            <div class="group__modal__buttons">
                <app-cyber-button
                    [disabled]="(this.isGroupLoading$ | async) || false"
                    (click)="confirmDelete()"
                    [buttonText]="'Delete'"
                ></app-cyber-button>
                <app-cyber-button
                    (click)="cancelGroupDelete()"
                    [buttonText]="'Cancel'"
                ></app-cyber-button>
            </div>
        </div>
    </div>

    <div *ngIf="isCreateMode">
        <form class="group__form" *ngIf="groupForm" [formGroup]="groupForm">
            <h2 class="group__form__title">Create group</h2>
            <div
                class="group__form__control"
                [ngClass]="{ invalid: name?.touched && name?.invalid }"
            >
                <label for="name">group name</label>
                <input
                    id="name"
                    type="name"
                    formControlName="name"
                    autocomplete="name"
                />
                <div class="validation" *ngIf="name?.touched && name?.invalid">
                    <small *ngIf="getError('name', 'required')">
                        Please enter a name
                    </small>
                    <small *ngIf="getError('name', 'maxlength')">
                        The name exceeds 30 characters
                    </small>
                    <small *ngIf="getError('name', 'pattern')">
                        The name must contain only letters, numbers, or spaces
                    </small>
                </div>
            </div>

            <div class="group__form__buttons">
                <app-cyber-button
                    [disabled]="
                        groupForm.invalid ||
                        (this.isGroupLoading$ | async) ||
                        false
                    "
                    (click)="onCreateGroupSubmit()"
                    [buttonText]="'Create'"
                ></app-cyber-button>

                <app-cyber-button
                    (click)="onCancelCreate()"
                    [buttonText]="'Cancel'"
                ></app-cyber-button>
            </div>
        </form>
    </div>

    <ng-template #loading>
        <p>Loading...</p>
    </ng-template>
</div>
