"use strict";(self.webpackChunkangular_messenger=self.webpackChunkangular_messenger||[]).push([[838],{5838:(V,f,a)=>{a.r(f),a.d(f,{AuthModule:()=>G});var m=a(6814),g=a(4087),s=a(6223),p=function(e){return e.InvalidFormDataException="InvalidFormDataException",e.NotFoundException="NotFoundException",e}(p||{}),_=a(8645),d=a(9773),t=a(5879),v=a(6238),b=a(9862);let w=(()=>{class e{constructor(i){this.http=i,this.apiUrl=v.AW}loginUser(i){const{email:r,password:n}=i;return this.http.post(this.apiUrl,{email:r,password:n})}static#t=this.\u0275fac=function(r){return new(r||e)(t.LFG(b.eN))};static#e=this.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac})}return e})();var C=a(754),F=a(4567),T=a(7466);function U(e,o){1&e&&(t.TgZ(0,"small"),t._uU(1," Please enter a login email "),t.qZA())}function E(e,o){1&e&&(t.TgZ(0,"small"),t._uU(1," The login email is invalid "),t.qZA())}function S(e,o){if(1&e&&(t.TgZ(0,"div",12),t.YNc(1,U,2,0,"small",13),t.YNc(2,E,2,0,"small",13),t.qZA()),2&e){const i=t.oxw();t.xp6(1),t.Q6J("ngIf",i.getError("email","required")),t.xp6(1),t.Q6J("ngIf",i.getError("email","email"))}}function y(e,o){1&e&&(t.TgZ(0,"small"),t._uU(1," Please enter a password. "),t._UZ(2,"br"),t.qZA())}function x(e,o){if(1&e&&(t.TgZ(0,"small"),t._uU(1," Your password isn't strong enough. "),t._UZ(2,"br"),t._uU(3),t.qZA()),2&e){const i=t.oxw(2);t.xp6(3),t.hij(" Recommendations: ",null==i.password||null==i.password.errors?null:i.password.errors.message," ")}}function I(e,o){if(1&e&&(t.TgZ(0,"div",12),t.YNc(1,y,3,0,"small",13),t.YNc(2,x,4,1,"small",13),t.qZA()),2&e){const i=t.oxw();t.xp6(1),t.Q6J("ngIf",i.getError("password","required")),t.xp6(1),t.Q6J("ngIf",i.getError("password","strongPassword"))}}const Z=function(e){return{invalid:e}};let A=(()=>{class e{constructor(i,r,n,l,u){this.fb=i,this.loginService=r,this.toastService=n,this.authService=l,this.router=u,this.isSubmitting=!1,this.isHttpError=!1,this.hasUserChangedInput=!1,this.ngUnsubscribe=new _.x}ngOnInit(){this.initForm(),this.subscribeToFormChanges()}initForm(){this.loginForm=this.fb.group({email:["courses@mail.ru",[s.kI.required,s.kI.email]],password:["1!qQwerty",[s.kI.required]]})}subscribeToFormChanges(){this.formChangesSubscription=this.loginForm.valueChanges.subscribe(()=>{this.hasUserChangedInput&&(this.hasUserChangedInput=!1)})}get email(){return this.loginForm.get("email")}get password(){return this.loginForm.get("password")}getError(i,r){return this.loginForm.get(i)?.hasError(r)}onSubmit(){if(this.loginForm.invalid||this.isSubmitting)return;const i=this.loginForm.value;this.isSubmitting=!0,this.hasUserChangedInput=!0,this.loginService.loginUser(i).pipe((0,d.R)(this.ngUnsubscribe)).subscribe({next:r=>this.handleLoginSuccess(r),error:r=>this.handleLoginError(r)})}handleLoginSuccess(i){this.isSubmitting=!1,this.authService.saveCredentialsToLocalStorage(i,this.loginForm.value.email),this.showToastAndRedirect()}showToastAndRedirect(){this.toastService.showToast("Login successful!",!1),this.router.navigateByUrl("/")}handleLoginError(i){if(this.isSubmitting=!1,400===i.status)switch(i.error.type){case p.InvalidFormDataException:this.handleInvalidFormDataException(i.error.message);break;case p.NotFoundException:this.handleNotFoundException(i.error.message);break;default:this.handleOtherErrors()}else this.isHttpError=!0,this.handleOtherErrors()}handleInvalidFormDataException(i){this.toastService.showToast(i,!0)}handleNotFoundException(i){this.toastService.showToast(i,!0)}handleOtherErrors(){this.toastService.showToast("Login error",!0)}ngOnDestroy(){this.formChangesSubscription&&this.formChangesSubscription.unsubscribe(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}static#t=this.\u0275fac=function(r){return new(r||e)(t.Y36(s.qu),t.Y36(w),t.Y36(C.k),t.Y36(F.e),t.Y36(g.F0))};static#e=this.\u0275cmp=t.Xpm({type:e,selectors:[["app-login-page"]],decls:20,vars:11,consts:[[1,"login",3,"formGroup","ngSubmit"],[1,"login__title"],[1,"login__control",3,"ngClass"],["for","email"],["id","email","type","email","formControlName","email","autocomplete","email"],["class","validation",4,"ngIf"],["for","password"],["id","password","type","password","formControlName","password","autocomplete","current-password",3,"input"],[1,"login__link"],["routerLink","/auth/signup"],[1,"login__button-submit"],["type","submit",3,"disabled","buttonText"],[1,"validation"],[4,"ngIf"]],template:function(r,n){1&r&&(t.TgZ(0,"form",0),t.NdJ("ngSubmit",function(){return n.onSubmit()}),t.TgZ(1,"h2",1),t._uU(2,"Sign In"),t.qZA(),t.TgZ(3,"div",2)(4,"label",3),t._uU(5,"login"),t.qZA(),t._UZ(6,"input",4),t.YNc(7,S,3,2,"div",5),t.qZA(),t.TgZ(8,"div",2)(9,"label",6),t._uU(10," password "),t.qZA(),t.TgZ(11,"input",7),t.NdJ("input",function(){return null==n.password?null:n.password.markAsTouched()}),t.qZA(),t.YNc(12,I,3,2,"div",5),t.qZA(),t.TgZ(13,"div",8)(14,"span"),t._uU(15,"Don't have an account? "),t.qZA(),t.TgZ(16,"a",9),t._uU(17," Sign Up "),t.qZA()(),t.TgZ(18,"div",10),t._UZ(19,"app-cyber-button",11),t.qZA()()),2&r&&(t.Q6J("formGroup",n.loginForm),t.xp6(3),t.Q6J("ngClass",t.VKq(7,Z,(null==n.email?null:n.email.touched)&&(null==n.email?null:n.email.invalid))),t.xp6(4),t.Q6J("ngIf",(null==n.email?null:n.email.touched)&&(null==n.email?null:n.email.invalid)),t.xp6(1),t.Q6J("ngClass",t.VKq(9,Z,(null==n.password?null:n.password.touched)&&(null==n.password?null:n.password.invalid))),t.xp6(4),t.Q6J("ngIf",(null==n.password?null:n.password.touched)&&(null==n.password?null:n.password.invalid)),t.xp6(7),t.Q6J("disabled",n.loginForm.invalid||n.isSubmitting||n.isHttpError||n.hasUserChangedInput)("buttonText",n.isSubmitting?"Logging in...":"Login"))},dependencies:[m.mk,m.O5,g.rH,T.w,s._Y,s.Fj,s.JJ,s.JL,s.sg,s.u],styles:[".login[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:700px;margin:0 auto;padding:2rem 1.5rem;background:var(--background-auth);border-radius:10px;clip-path:polygon(0 0,calc(100% - 95px) 0,100% 95px,100% 100%,70px 100%,0 calc(100% - 70px))}.login__title[_ngcontent-%COMP%]{margin-bottom:1rem}.login__control[_ngcontent-%COMP%]{color:#888}.login__control[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{padding-left:.5rem;margin-top:1rem}.login__control[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;height:3rem;border-color:transparent;background-color:var(--background);transition:border-color .3s;outline-color:var(--primary);margin:.3rem auto;padding:1rem}.login__link[_ngcontent-%COMP%]{padding:1rem 0;font-size:.8rem}.login__link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--color-alert)}.login__button-submit[_ngcontent-%COMP%]{display:flex;padding-top:1rem}.validation[_ngcontent-%COMP%], .invalid[_ngcontent-%COMP%]{color:var(--danger-color)}.invalid[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border:1px solid var(--danger-color);outline-color:var(--danger-color)}"]})}return e})();var c=function(e){return e.InvalidFormData="InvalidFormDataException",e.UnknownFormat="Invalid post data",e.MissingParameters='Parameters "email", "name", and "password" are required',e.UserExists="PrimaryDuplicationException",e}(c||{});let P=(()=>{class e{constructor(i){this.http=i,this.apiUrl=v.WC}registerUser(i){const{name:r,email:n,password:l}=i;return this.http.post(this.apiUrl,{name:r,email:n,password:l})}static#t=this.\u0275fac=function(r){return new(r||e)(t.LFG(b.eN))};static#e=this.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac})}return e})();function O(e,o){1&e&&(t.TgZ(0,"small"),t._uU(1," Please enter a name "),t.qZA())}function k(e,o){1&e&&(t.TgZ(0,"small"),t._uU(1," The name exceeds 40 characters "),t.qZA())}function J(e,o){if(1&e&&(t.TgZ(0,"div",12),t.YNc(1,O,2,0,"small",13),t.YNc(2,k,2,0,"small",13),t.qZA()),2&e){const i=t.oxw();t.xp6(1),t.Q6J("ngIf",i.getError("name","required")),t.xp6(1),t.Q6J("ngIf",i.getError("name","maxlength"))}}function M(e,o){1&e&&(t.TgZ(0,"small"),t._uU(1,"Please enter a register email"),t.qZA())}function N(e,o){1&e&&(t.TgZ(0,"small"),t._uU(1,"The register email is invalid"),t.qZA())}function Y(e,o){1&e&&(t.TgZ(0,"small"),t._uU(1,"Email address is already taken"),t.qZA())}function R(e,o){if(1&e&&(t.TgZ(0,"div",12),t.YNc(1,M,2,0,"small",13),t.YNc(2,N,2,0,"small",13),t.YNc(3,Y,2,0,"small",13),t.qZA()),2&e){const i=t.oxw();t.xp6(1),t.Q6J("ngIf",i.getError("email","required")),t.xp6(1),t.Q6J("ngIf",i.getError("email","email")),t.xp6(1),t.Q6J("ngIf",i.isPrimaryDuplicationError||i.getError("email","taken"))}}function D(e,o){1&e&&(t.TgZ(0,"small"),t._uU(1,"Please enter a password. "),t._UZ(2,"br"),t.qZA())}function Q(e,o){if(1&e&&(t.TgZ(0,"small"),t._uU(1," Your password isn't strong enough. "),t._UZ(2,"br"),t._uU(3),t.qZA()),2&e){const i=t.oxw(2);t.xp6(3),t.hij(" Recommendations: ",null==i.password||null==i.password.errors?null:i.password.errors.message," ")}}function L(e,o){if(1&e&&(t.TgZ(0,"div",12),t.YNc(1,D,3,0,"small",13),t.YNc(2,Q,4,1,"small",13),t.qZA()),2&e){const i=t.oxw();t.xp6(1),t.Q6J("ngIf",i.getError("password","required")),t.xp6(1),t.Q6J("ngIf",i.getError("password","strongPassword"))}}const h=function(e){return{invalid:e}},z=[{path:"",redirectTo:"signin",pathMatch:"full"},{path:"signin",component:A},{path:"signup",component:(()=>{class e{constructor(i,r,n,l){this.fb=i,this.registerService=r,this.router=n,this.toastService=l,this.isSubmitting=!1,this.isHttpError=!1,this.isPrimaryDuplicationError=!1,this.usedEmails=[],this.emailUnsubscribe$=new _.x}ngOnInit(){this.initForm(),this.subscribeToFormChanges()}initForm(){this.registerForm=this.fb.group({name:["Shadow",[s.kI.required,s.kI.maxLength(40)]],email:["courses@mail.ru",[s.kI.required,s.kI.email]],password:["1!qQwerty",[s.kI.required,e=>{const{value:o}=e,i=o?.length>=8,r=/[a-z]/.test(o)&&/[A-Z]/.test(o),n=/\d/.test(o)&&/[a-zA-Z]/.test(o),l=/[!@#?]/.test(o);if(i&&r&&n&&l)return null;let u="";return i||(u+="at least 8 characters, "),r||(u+="a mixture of both uppercase and lowercase letters, "),n||(u+="a mixture of letters and numbers, "),l||(u+="inclusion of at least one special character, e.g., ! @ # ? "),{strongPassword:!0,message:u}}]]})}subscribeToFormChanges(){this.registerForm.get("email")?.valueChanges.pipe((0,d.R)(this.emailUnsubscribe$)).subscribe(i=>{this.checkForDuplication(i)})}get name(){return this.registerForm.get("name")}get email(){return this.registerForm.get("email")}get password(){return this.registerForm.get("password")}getError(i,r){return this.registerForm.get(i)?.hasError(r)}onSubmit(){if(this.registerForm.invalid||this.isSubmitting)return;const i=this.registerForm.value;this.isSubmitting=!0,this.registerService.registerUser(i).pipe((0,d.R)(this.emailUnsubscribe$)).subscribe({next:()=>this.handleRegistrationSuccess(),error:r=>this.handleRegistrationError(r)})}handleRegistrationSuccess(){this.isSubmitting=!1,this.toastService.showToast("Registration successful!",!1),this.usedEmails=[],this.router.navigate(["auth","signin"])}handleRegistrationError(i){if(this.isSubmitting=!1,400===i.status)switch(i.error.type){case c.InvalidFormData||c.UnknownFormat||c.MissingParameters:this.handleInvalidFormDataException(i.error.message);break;case c.UserExists:this.handlePrimaryDuplicationException(i.error.message);break;default:this.handleOtherErrors()}else this.isHttpError=!0,this.handleOtherErrors()}handleInvalidFormDataException(i){this.toastService.showToast(i,!0)}handlePrimaryDuplicationException(i){this.toastService.showToast(i,!0),this.isPrimaryDuplicationError=!0,this.registerForm.get("email")?.setErrors({taken:!0}),this.usedEmails.push(this.registerForm.value.email)}handleOtherErrors(){this.toastService.showToast("Registration error",!0)}checkForDuplication(i){this.isPrimaryDuplicationError=this.usedEmails.includes(i),this.isPrimaryDuplicationError&&this.registerForm.get("email")?.setErrors({taken:!0})}ngOnDestroy(){this.emailUnsubscribe$.next(),this.emailUnsubscribe$.complete()}static#t=this.\u0275fac=function(r){return new(r||e)(t.Y36(s.qu),t.Y36(P),t.Y36(g.F0),t.Y36(C.k))};static#e=this.\u0275cmp=t.Xpm({type:e,selectors:[["app-register-page"]],decls:20,vars:15,consts:[[1,"register",3,"formGroup","ngSubmit"],[1,"register__title"],[1,"register__control",3,"ngClass"],["for","name"],["id","name","type","name","formControlName","name","autocomplete","name"],["class","validation",4,"ngIf"],["for","email"],["id","email","type","email","formControlName","email","autocomplete","email"],["for","password"],["id","password","type","password","formControlName","password","autocomplete","current-password",3,"input"],[1,"register__button-submit"],["type","submit",3,"disabled","buttonText"],[1,"validation"],[4,"ngIf"]],template:function(r,n){1&r&&(t.TgZ(0,"form",0),t.NdJ("ngSubmit",function(){return n.onSubmit()}),t.TgZ(1,"h2",1),t._uU(2,"Sign Up"),t.qZA(),t.TgZ(3,"div",2)(4,"label",3),t._uU(5,"name"),t.qZA(),t._UZ(6,"input",4),t.YNc(7,J,3,2,"div",5),t.qZA(),t.TgZ(8,"div",2)(9,"label",6),t._uU(10,"email"),t.qZA(),t._UZ(11,"input",7),t.YNc(12,R,4,3,"div",5),t.qZA(),t.TgZ(13,"div",2)(14,"label",8),t._uU(15," password "),t.qZA(),t.TgZ(16,"input",9),t.NdJ("input",function(){return null==n.password?null:n.password.markAsTouched()}),t.qZA(),t.YNc(17,L,3,2,"div",5),t.qZA(),t.TgZ(18,"div",10),t._UZ(19,"app-cyber-button",11),t.qZA()()),2&r&&(t.Q6J("formGroup",n.registerForm),t.xp6(3),t.Q6J("ngClass",t.VKq(9,h,(null==n.name?null:n.name.touched)&&(null==n.name?null:n.name.invalid))),t.xp6(4),t.Q6J("ngIf",(null==n.name?null:n.name.touched)&&(null==n.name?null:n.name.invalid)),t.xp6(1),t.Q6J("ngClass",t.VKq(11,h,(null==n.email?null:n.email.touched)&&(null==n.email?null:n.email.invalid))),t.xp6(4),t.Q6J("ngIf",(null==n.email?null:n.email.touched)&&(null==n.email?null:n.email.invalid)),t.xp6(1),t.Q6J("ngClass",t.VKq(13,h,(null==n.password?null:n.password.touched)&&(null==n.password?null:n.password.invalid))),t.xp6(4),t.Q6J("ngIf",(null==n.password?null:n.password.touched)&&(null==n.password?null:n.password.invalid)),t.xp6(2),t.Q6J("disabled",n.registerForm.invalid||n.isSubmitting||n.isPrimaryDuplicationError||n.isHttpError)("buttonText",n.isSubmitting?"Registering...":"Register"))},dependencies:[m.mk,m.O5,T.w,s._Y,s.Fj,s.JJ,s.JL,s.sg,s.u],styles:[".register[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:700px;margin:0 auto;padding:2rem 1.5rem;background:var(--background-auth);border-radius:10px;clip-path:polygon(0 0,calc(100% - 115px) 0,100% 115px,100% 100%,60px 100%,0 calc(100% - 60px));-webkit-mask:var(--mask);mask:var(--mask)}.register__title[_ngcontent-%COMP%]{margin-bottom:1rem}.register__control[_ngcontent-%COMP%]{color:#888}.register__control[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{padding-left:.5rem;margin-top:1rem}.register__control[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;height:3rem;border-color:transparent;background-color:var(--background);transition:border-color .3s;outline-color:var(--primary);margin:.3rem auto;padding:1rem}.register__button-submit[_ngcontent-%COMP%]{display:flex;padding-top:1rem}.validation[_ngcontent-%COMP%], .invalid[_ngcontent-%COMP%]{color:var(--danger-color)}.invalid[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border:1px solid var(--danger-color);outline-color:var(--danger-color)}"]})}return e})()}];let j=(()=>{class e{static#t=this.\u0275fac=function(r){return new(r||e)};static#e=this.\u0275mod=t.oAB({type:e});static#i=this.\u0275inj=t.cJS({imports:[g.Bz.forChild(z),g.Bz]})}return e})();var H=a(153);let G=(()=>{class e{static#t=this.\u0275fac=function(r){return new(r||e)};static#e=this.\u0275mod=t.oAB({type:e});static#i=this.\u0275inj=t.cJS({providers:[P,w],imports:[m.ez,j,H.m]})}return e})()}}]);